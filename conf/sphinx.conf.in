source def_pqsql
{
    type = pgsql
    sql_host = pgcluster0t.bgdi.admin.ch
    sql_user = $PGUSER
    sql_pass = $PGPASS
    sql_port = 5432
    sql_query_pre = SET NAMES 'UTF8'
}

source src_swisssearch : def_pqsql
{
    sql_db = search
    sql_attr_uint = num
    sql_attr_bigint = id
    sql_attr_uint = rank
    sql_attr_string = label
    sql_attr_string = origin
    sql_attr_string = geom_st_box2d
    sql_field_string = detail
}

source src_address : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , coalesce(strname1,'')||' '||coalesce(deinr,'')||' <b>'||coalesce(plz,'')||' '||coalesce(ort_27,'')||'</b>' as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , NULLIF(regexp_replace(deinr::text, '[^0-9]'::text, ''::text, 'g'::text), ''::text)::integer as num \
        from swiss_search \
        where origin = 'address'
}

source src_parcel : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , coalesce(gemname,'')||' '||coalesce(name,'') as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , SUBSTRING(name FROM '([0-9]+)')::int as num \
        from swiss_search \
        where origin = 'parcel'
}

source src_sn25 : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , '<b>'||coalesce(name,'')||'</b> ('||coalesce(kanton,'')||') - '||coalesce(gemname,'') as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , 1 as num \
        from swiss_search \
        where origin = 'sn25'
}

source src_gg25 : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , '<b>'||coalesce(gemname,'')||' ('||coalesce(kanton,'')||')</b>' as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , 1 as num \
        from swiss_search \
        where origin = 'gg25'
}

source src_kantone : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , remove_accents(search_name) as detail \
        , '<b>'||name||'</b>' as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , 1 as num \
        from swiss_search \
        where origin = 'kantone'
}

source src_district : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , '<b>'||name||'</b>' as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , 1 as num \
        from swiss_search \
        where origin = 'district'
}

source src_zipcode : src_swisssearch
{
    sql_query = \
        SELECT \
        gid as id \
        , search_name as detail \
        , '<b>'||coalesce(plz,'')||' - '||coalesce(ort_27,'')||' ('||coalesce(kanton,'')||')</b>' as label \
        , origin as origin \
        , st_box2d(the_geom) as geom_st_box2d \
        , rank as rank \
        , gid as id \
        , 1 as num \
        from swiss_search \
        where origin = 'zipcode'
}

source layers : def_pqsql
{
    sql_db = bod
    sql_attr_bigint = id
    sql_attr_string = lang
    sql_attr_string = origin
    sql_attr_string = label
    sql_field_string = staging
    sql_field_string = topics
    sql_field_string = layer
    sql_field_string = detail
}

source src_layers_de : layers
{
    sql_query = \
        SELECT \
            bgdi_id::bigint as id \
            , '<b>'||kurzbezeichnung||'</b>' as label \
            , 'layer' as origin \
            , remove_accents(volltextsuche) as detail \
            , bod_layer_id as layer \
            , 'de' as lang \
            , topics as topics \
            , staging as staging \
            , bgdi_id::bigint as id \
        from (SELECT view_layers_js.bgdi_id, \
            view_bod_layer_info_de.kurzbezeichnung, \
            view_bod_layer_info_de.volltextsuche, \
            view_bod_layer_info_de.bod_layer_id, \
            view_layers_js.topics, \
            view_layers_js.staging \
        from re3.view_layers_js, \
            re3.view_bod_layer_info_de \
            where view_layers_js.bod_layer_id = view_bod_layer_info_de.bod_layer_id) as res
}

source src_layers_fr : layers
{
    sql_query = \
        SELECT \
            bgdi_id::bigint as id \
            , '<b>'||kurzbezeichnung||'</b>' as label \
            , 'layer' as origin \
            , remove_accents(volltextsuche) as detail \
            , bod_layer_id as layer \
            , 'fr' as lang \
            , topics as topics \
            , staging as staging \
            , bgdi_id::bigint as id \
        from (SELECT view_layers_js.bgdi_id, \
            view_bod_layer_info_fr.kurzbezeichnung, \
            view_bod_layer_info_fr.volltextsuche, \
            view_bod_layer_info_fr.bod_layer_id, \
            view_layers_js.topics, \
            view_layers_js.staging \
        from re3.view_layers_js, \
            re3.view_bod_layer_info_fr \
            where view_layers_js.bod_layer_id = view_bod_layer_info_fr.bod_layer_id) as res
}

source src_layers_en : layers
{
    sql_query = \
        SELECT \
            bgdi_id::bigint as id \
            , '<b>'||kurzbezeichnung||'</b>' as label \
            , 'layer' as origin \
            , remove_accents(volltextsuche) as detail \
            , bod_layer_id as layer \
            , 'en' as lang \
            , topics as topics \
            , staging as staging \
            , bgdi_id::bigint as id \
        from (SELECT view_layers_js.bgdi_id, \
            view_bod_layer_info_en.kurzbezeichnung, \
            view_bod_layer_info_en.volltextsuche, \
            view_bod_layer_info_en.bod_layer_id, \
            view_layers_js.topics, \
            view_layers_js.staging \
        from re3.view_layers_js, \
            re3.view_bod_layer_info_en \
            where view_layers_js.bod_layer_id = view_bod_layer_info_en.bod_layer_id) as res
}

source src_layers_it : layers
{
    sql_query = \
        SELECT \
            bgdi_id::bigint as id \
            , '<b>'||kurzbezeichnung||'</b>' as label \
            , 'layer' as origin \
            , remove_accents(volltextsuche) as detail \
            , bod_layer_id as layer \
            , 'it' as lang \
            , topics as topics \
            , staging as staging \
            , bgdi_id::bigint as id \
        from (SELECT view_layers_js.bgdi_id, \
            view_bod_layer_info_it.kurzbezeichnung, \
            view_bod_layer_info_it.volltextsuche, \
            view_bod_layer_info_it.bod_layer_id, \
            view_layers_js.topics, \
            view_layers_js.staging \
        from re3.view_layers_js, \
            re3.view_bod_layer_info_it \
            where view_layers_js.bod_layer_id = view_bod_layer_info_it.bod_layer_id) as res
}

source src_layers_rm : layers
{
    sql_query = \
        SELECT \
            bgdi_id::bigint as id \
            , '<b>'||kurzbezeichnung||'</b>' as label \
            , 'layer' as origin \
            , remove_accents(volltextsuche) as detail \
            , bod_layer_id as layer \
            , 'rm' as lang \
            , topics as topics \
            , staging as staging \
            , bgdi_id::bigint as id \
        from (SELECT view_layers_js.bgdi_id, \
            view_bod_layer_info_rm.kurzbezeichnung, \
            view_bod_layer_info_rm.volltextsuche, \
            view_bod_layer_info_rm.bod_layer_id, \
            view_layers_js.topics, \
            view_layers_js.staging \
        from re3.view_layers_js, \
            re3.view_bod_layer_info_rm \
            where view_layers_js.bod_layer_id = view_bod_layer_info_rm.bod_layer_id) as res
}

source def_searchable_features : def_pqsql
{
    sql_attr_bigint = id
    sql_attr_string = origin
    sql_attr_string = layer
    sql_attr_string = geom_st_box2d
    sql_attr_string = label
    sql_attr_float = lat
    sql_attr_float = lon
    sql_field_string = geom_quadindex
    sql_field_string = detail
}

source src_ch_astra_ivs-nat : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT nat_id::bigint as id \
            , ivs_nummer as label \
            , 'feature' as origin \
            , remove_accents(ivs_slaname)||' '||remove_accents(ivs_nummer)||' '||remove_accents(ivs_signatur) as detail \
            , 'ch.astra.ivs-nat' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d   \
            , nat_id::bigint as id \
        from astra.ivs_nat
}

source src_ch_astra_ivs-reg_loc : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT reg_loc_id::bigint as id \
            , ivs_nummer as label \
            , 'feature' as origin \
            , remove_accents(ivs_slaname)||' '||remove_accents(ivs_nummer)||' '||remove_accents(ivs_signatur) as detail \
            , 'ch.astra.ivs-reg_loc' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , reg_loc_id::bigint as id \
        from astra.ivs_reg_loc
}

source src_ch_astra_strassenverkehrszaehlung_messstellen-uebergeordnet : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT nr::bigint as id \
            , zaehlstellen_bezeichnung as label \
            , 'feature' as origin \
            , nr||' '||remove_accents(zaehlstellen_bezeichnung) as detail \
            , 'ch.astra.strassenverkehrszaehlung_messstellen-uebergeordnet' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , nr::bigint as id \
        from astra.verkehr_ueber
}

source src_ch_astra_strassenverkehrszaehlung_lokal : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT nr::bigint as id \
            , zaehlstellen_bezeichnung as label \
            , 'feature' as origin \
            , nr||' '||remove_accents(zaehlstellen_bezeichnung) as detail \
            , 'ch.astra.strassenverkehrszaehlung_messstellen-regional_lokal' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , nr::bigint as id \
        from astra.verkehr_reg_loc
}

source src_ch_swisstopo_fixpunkte-lfp1 : def_searchable_features
{
    sql_db = kogis
    sql_query = \
        SELECT gid::bigint as id \
            , pointid as label \
            , 'feature' as origin \
            , remove_accents(pointid)||' '||remove_accents(nummer) as detail \
            , 'ch.swisstopo.fixpunkte-lfp1' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from fpds.punkt_lage_lfp1
}

source src_ch_swisstopo_fixpunkte-lfp2 : def_searchable_features
{
    sql_db = kogis
    sql_query = \
        SELECT gid::bigint as id \
            , pointid as label \
            , 'feature' as origin \
            , remove_accents(pointid)||' '||remove_accents(nummer) as detail \
            , 'ch.swisstopo.fixpunkte-lfp2' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from fpds.punkt_lage_lfp2
}

source src_ch_swisstopo_fixpunkte-hfp1 : def_searchable_features
{
    sql_db = kogis
    sql_query = \
        SELECT gid::bigint as id \
            , pointid as label \
            , 'feature' as origin \
            , remove_accents(pointid)||' '||remove_accents(nummer)||' '||remove_accents(bgdi_label) as detail \
            , 'ch.swisstopo.fixpunkte-hfp1' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from fpds.punkt_hoehe_hfp1
}

source src_ch_swisstopo_fixpunkte-hfp2 : def_searchable_features
{
    sql_db = kogis
    sql_query = \
        SELECT gid::bigint as id \
            , pointid as label \
            , 'feature' as origin \
            , remove_accents(pointid)||' '||remove_accents(nummer) as detail \
            , 'ch.swisstopo.fixpunkte-hfp2' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from fpds.punkt_hoehe_hfp2
}

source src_ch_swisstopo_geologie-rohstoffe-industrieminerale : def_searchable_features
{
    sql_db = stopo
    sql_query = \
        SELECT id::bigint as id \
            , name_ads as label \
            , 'feature' as origin \
            , remove_accents(name_ads) as detail \
            , 'ch.swisstopo.geologie-rohstoffe-industrieminerale' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , id::bigint as id \
        from geol.rohstoffe_industrieminerale
}

source src_ch_swisstopo_geologie-rohstoffe-kohlen_bitumen_erdgas : def_searchable_features
{
    sql_db = stopo
    sql_query = \
        SELECT id::bigint as id \
            , name_ads as label \
            , 'feature' as origin \
            , remove_accents(name_ads) as detail \
            , 'ch.swisstopo.geologie-rohstoffe-kohlen_bitumen_erdgas' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , id::bigint as id \
        from geol.rohstoffe_kohlen_bitumen_erdgas
}

source src_ch_swisstopo_verschiebungsvektoren-tsp1 : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , name as label \
          , 'feature' as origin \
          , remove_accents(name) as detail \
          , 'ch.swisstopo.verschiebungsvektoren-tsp1' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geodaesie.verschiebungsvektoren_tsp1
}

source src_ch_swisstopo_verschiebungsvektoren-tsp2 : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , name as label \
          , 'feature' as origin \
          , remove_accents(name) as detail \
          , 'ch.swisstopo.verschiebungsvektoren-tsp2' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geodaesie.verschiebungsvektoren_tsp2
}

source src_ch_swisstopo_geologie-rohstoffe-vererzungen : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , name_ads as label \
          , 'feature' as origin \
          , remove_accents(name_ads) as detail \
          , 'ch.swisstopo.geologie-rohstoffe-vererzungen' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geol.rohstoffe_vererzungen
}

source src_ch_swisstopo_geologie-geotechnik-ziegeleien_1907 : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , ziegelei_2 as label \
          , 'feature' as origin \
          , remove_accents(ziegelei_2) as detail \
          , 'ch.swisstopo.geologie-geotechnik-ziegeleien_1907' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geol.geotechnik_ziegeleien_1907
}

source src_ch_swisstopo_geologie-geotechnik-ziegeleien_1965 : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , ziegelei as label \
          , 'feature' as origin \
          , remove_accents(ziegelei) as detail \
          , 'ch.swisstopo.geologie-geotechnik-ziegeleien_1965' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geol.geotechnik_ziegeleien_1965
}

source src_ch_swisstopo_geologie-geotechnik-ziegeleien_1995 : def_searchable_features
{
   sql_db = stopo
   sql_query = \
      SELECT id::bigint as id \
          , ziegeleien as label \
          , 'feature' as origin \
          , remove_accents(ziegeleien) as detail \
          , 'ch.swisstopo.geologie-geotechnik-ziegeleien_1995' as layer \
          , quadindex(the_geom) as geom_quadindex \
          , y(st_transform(st_centroid(the_geom),4326)) as lat \
          , x(st_transform(st_centroid(the_geom),4326)) as lon \
          , st_box2d(the_geom) as geom_st_box2d \
          , id::bigint as id \
      from geol.geotechnik_ziegeleien_1995
}

source src_ch_babs_kulturgueter : def_searchable_features
{
    sql_db = vbs
    sql_query = \
        SELECT kgs_nr::bigint as id \
            , zkob as label \
            , 'feature' as origin \
            , remove_accents(zkob) as detail \
            , 'ch.babs.kulturgueter' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , kgs_nr::bigint as id \
        from babs.kgs
}

source src_ch_bakom_radio-fernsehsender : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT id::bigint as id \
            , name as label \
            , 'feature' as origin \
            , remove_accents(name)||' '||remove_accents(code) as detail \
            , 'ch.bakom.radio-fernsehsender' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , id::bigint as id \
        from bakom.nisdb_bro_tooltip
}

source src_ch_bakom_versorgungsgebiet-tv : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT gid::bigint as id \
            , prog as label \
            , 'feature' as origin \
            , remove_accents(prog) as detail \
            , 'ch.bakom.versorgungsgebiet-tv' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from bakom.tv_gebiet
}

source src_ch_bakom_versorgungsgebiet-ukw : def_searchable_features
{
    sql_db = uvek
    sql_query = \
        SELECT gid::bigint as id \
            , prog as label \
            , 'feature' as origin \
            , remove_accents(prog) as detail \
            , 'ch.bakom.versorgungsgebiet-ukw' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from bakom.ukw_gebiet
}

source src_ch_bafu_hydrologie-wassertemperaturmessstationen : def_searchable_features
{
    sql_db = bafu
    sql_query = \
        SELECT nr::bigint as id \
            , name as label \
            , 'feature' as origin \
            , nr::text||' '||remove_accents(name) as detail \
            , 'ch.bafu.hydrologie-wassertemperaturmessstationen' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , nr::bigint as id \
        from hydrologie.temperaturmessnetz
}

source src_ch_bafu_hydrologie-gewaesserzustandsmessstationen : def_searchable_features
{
    sql_db = bafu
    sql_query = \
        SELECT nr::bigint as id \
            , name as label \
            , 'feature' as origin \
            , nr::text||' '||remove_accents(name)||' '||remove_accents(gewaesser) as detail \
            , 'ch.bafu.hydrologie-gewaesserzustandsmessstationen' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , nr::bigint as id \
        from hydrologie.dbgz
}

source src_ch_bafu_bundesinventare-auen : def_searchable_features
{
    sql_db = bafu
    sql_query = \
        SELECT gid::bigint as id \
            , au_name as label \
            , 'feature' as origin \
            , au_obj::text||' '||remove_accents(au_name) as detail \
            , 'ch.bafu.bundesinventare-auen' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , gid::bigint as id \
        from bundinv.au
}

source def_searchable_features_with_year : def_searchable_features
{
    sql_attr_uint = year
}

source src_ch_swisstopo_lubis-luftbilder : def_searchable_features_with_year
{
    sql_db = lubis
    sql_query = \
        SELECT oid as id \
            , bildnummer::text||' ('||coalesce(ort,'')||', '||coalesce(ebkey,'')||')' as label \
            , 'feature' as origin \
            , ebkey as detail \
            , 'ch.swisstopo.lubis-luftbilder' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , bgdi_flugjahr as year \
            , oid as id \
        from public.view_luftbilder_swisstopo
}

source src_ch_swisstopo_lubis-luftbilder-dritte-kantone : def_searchable_features_with_year
{
    sql_db = lubis
    sql_query = \
        SELECT oid as id \
            , bildnummer::text||' ('||coalesce(ort,'')||', '||coalesce(ebkey,'')||')' as label \
            , 'feature' as origin \
            , ebkey as detail \
            , 'ch.swisstopo.lubis-luftbilder-dritte-kantone' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , bgdi_flugjahr as year \
            , oid as id \
        from public.view_luftbilder_dritte_kantone
}

source src_ch_swisstopo_lubis-luftbilder-dritte-firmen : def_searchable_features_with_year
{
    sql_db = lubis
    sql_query = \
        SELECT oid as id \
            , bildnummer::text||' ('||coalesce(ort,'')||', '||coalesce(ebkey,'')||')' as label \
            , 'feature' as origin \
            , ebkey as detail \
            , 'ch.swisstopo.lubis-luftbilder-dritte-firmen' as layer \
            , quadindex(the_geom) as geom_quadindex \
            , y(st_transform(st_centroid(the_geom),4326)) as lat \
            , x(st_transform(st_centroid(the_geom),4326)) as lon \
            , st_box2d(the_geom) as geom_st_box2d \
            , bgdi_flugjahr as year \
            , oid as id \
        from public.view_luftbilder_dritte_firmen
}

# Not needed now as we only support searchable layers right now
#source src_ch_bfs_gebaeude_wohnungs_register : def_pqsql
#{
#    sql_db = search
#    sql_query = \
#        SELECT \
#        gid as id \
#        , strname1||' '||deinr||' <b>'||plz||' '||ort_27||'</b>' as label \
#        , origin as origin \
#        , 'ch.bfs.gebaeude_wohnungs_register' as layer \
#        , quadindex(the_geom) as geom_quadindex \
#        , y(st_transform(st_centroid(the_geom),4326)) as lat \
#        , x(st_transform(st_centroid(the_geom),4326)) as lon \
#        , st_box2d(the_geom) as geom_st_box2d \
#        , rank as rank \
#        , gid as id \
#        from swiss_search \
#        where origin = 'address'
#    sql_attr_bigint = id
#    sql_attr_uint = rank
#    sql_attr_string = layer
#    sql_attr_string = label
#    sql_attr_string = origin
#    sql_attr_string = geom_st_box2d
#    sql_attr_float = lat
#    sql_attr_float = lon
#    sql_field_string = geom_quadindex
#}
#


index zipcode
{
    source = src_zipcode
    path = /var/lib/sphinxsearch/data/index/zipcode
    type = plain
    docinfo = extern
    charset_type = utf-8
    min_infix_len = 2
    infix_fields = detail
    enable_star = 1
}

index district : zipcode
{
    source = src_district
    path = /var/lib/sphinxsearch/data/index/district
}

index kantone : zipcode
{
    source = src_kantone
    path = /var/lib/sphinxsearch/data/index/kantone
}

index gg25 : zipcode
{
    source = src_gg25
    path = /var/lib/sphinxsearch/data/index/gg25
}

index sn25 : zipcode
{
    source = src_sn25
    path = /var/lib/sphinxsearch/data/index/sn25
}

index parcel : zipcode
{
    source = src_parcel
    path = /var/lib/sphinxsearch/data/index/parcel
}

index address : zipcode
{
    source = src_address
    path = /var/lib/sphinxsearch/data/index/address
}

# Not needed currently
#index address_fuzzy : zipcode
#{
#    source = src_address
#    path = /var/lib/sphinxsearch/data/index/address_fuzzy
#    morphology = soundex, metaphone
#}

index swisssearch
{
    type = distributed
    local = zipcode
    local = district
    local = kantone
    local = gg25
    local = sn25
    local = parcel
    local = address
}

index layers_de
{
    type = plain
    docinfo = extern
    charset_type = utf-8
    min_infix_len = 2
    infix_fields = detail, layer, topics, staging
    source = src_layers_de
    path = /var/lib/sphinxsearch/data/index/layers_de
}

index layers_fr : layers_de
{
    source = src_layers_fr
    path = /var/lib/sphinxsearch/data/index/layers_fr
}

index layers_en : layers_de
{
    source = src_layers_en
    path = /var/lib/sphinxsearch/data/index/layers_en
}

index layers_it : layers_de
{
    source = src_layers_it
    path = /var/lib/sphinxsearch/data/index/layers_it
}

index layers_rm : layers_de
{
    source = src_layers_rm
    path = /var/lib/sphinxsearch/data/index/layers_rm
}

#First searchable layers. Serves as base
index ch_astra_ivs-nat
{
    type = plain
    source = src_ch_astra_ivs-nat
    path = /var/lib/sphinxsearch/data/index/ch_astra_ivs-nat
    docinfo = extern
    charset_type = utf-8
    min_infix_len = 2
    infix_fields = detail
    min_prefix_len = 1
    prefix_fields = geom_quadindex
    enable_star = 1
}

index ch_astra_ivs-nat-verlaeufe : ch_astra_ivs-nat
{
    path = /var/lib/sphinxsearch/data/index/ch_astra_ivs-nat-verlaeufe
}

index ch_astra_ivs-reg_loc : ch_astra_ivs-nat
{
    source = src_ch_astra_ivs-reg_loc
    path = /var/lib/sphinxsearch/data/index/ch_astra_ivs-reg_loc
}

index ch_astra_strassenverkehrszaehlung_messstellen-uebergeordnet : ch_astra_ivs-nat
{
    source =  src_ch_astra_strassenverkehrszaehlung_messstellen-uebergeordnet
    path = /var/lib/sphinxsearch/data/index/ch_astra_strassenverkehrszaehlung_messstellen-uebergeordnet
}

index ch_astra_strassenverkehrszaehlung_messstellen-regional_lokal : ch_astra_ivs-nat
{
    source =  src_ch_astra_strassenverkehrszaehlung_lokal
    path = /var/lib/sphinxsearch/data/index/ch_astra_strassenverkehrszaehlung_messstellen-regional_lokal
}

index ch_swisstopo_fixpunkte-lfp1 : ch_astra_ivs-nat
{
    source =  src_ch_swisstopo_fixpunkte-lfp1
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_fixpunkte-lfp1
}

index ch_swisstopo_fixpunkte-lfp2 : ch_astra_ivs-nat
{
    source =  src_ch_swisstopo_fixpunkte-lfp2
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_fixpunkte-lfp2
}

index ch_swisstopo_fixpunkte-hfp1 : ch_astra_ivs-nat
{
    source =  src_ch_swisstopo_fixpunkte-hfp1
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_fixpunkte-hfp1
}

index ch_swisstopo_fixpunkte-hfp2 : ch_astra_ivs-nat
{
    source =  src_ch_swisstopo_fixpunkte-hfp2
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_fixpunkte-hfp2
}

index ch_swisstopo_verschiebungsvektoren-tsp1 : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_verschiebungsvektoren-tsp1
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_verschiebungsvektoren-tsp1
}

index ch_swisstopo_verschiebungsvektoren-tsp2 : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_verschiebungsvektoren-tsp2
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_verschiebungsvektoren-tsp2
}

index ch_swisstopo_geologie-geotechnik-ziegeleien_1907 : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-geotechnik-ziegeleien_1907
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-geotechnik-ziegeleien_1907
}

index ch_swisstopo_geologie-geotechnik-ziegeleien_1965 : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-geotechnik-ziegeleien_1965
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-geotechnik-ziegeleien_1965
}

index ch_swisstopo_geologie-geotechnik-ziegeleien_1995 : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-geotechnik-ziegeleien_1995
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-geotechnik-ziegeleien_1995
}

index ch_swisstopo_geologie-rohstoffe-vererzungen : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-rohstoffe-vererzungen
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-rohstoffe-vererzungen
}

index ch_swisstopo_geologie-rohstoffe-industrieminerale : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-rohstoffe-industrieminerale
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-rohstoffe-industrieminerale
}

index ch_swisstopo_geologie-rohstoffe-kohlen_bitumen_erdgas : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_geologie-rohstoffe-kohlen_bitumen_erdgas
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_geologie-rohstoffe-kohlen_bitumen_erdgas
}

index ch_babs_kulturgueter : ch_astra_ivs-nat
{
    source = src_ch_babs_kulturgueter
    path = /var/lib/sphinxsearch/data/index/ch_babs_kulturgueter
}

index ch_bakom_radio-fernsehsender : ch_astra_ivs-nat
{
    source = src_ch_bakom_radio-fernsehsender
    path = /var/lib/sphinxsearch/data/index/ch_bakom_radio-fernsehsender
}

index ch_bakom_versorgungsgebiet-tv : ch_astra_ivs-nat
{
    source = src_ch_bakom_versorgungsgebiet-tv
    path = /var/lib/sphinxsearch/data/index/ch_bakom_versorgungsgebiet-tv
}

index ch_bakom_versorgungsgebiet-ukw : ch_astra_ivs-nat
{
    source = src_ch_bakom_versorgungsgebiet-ukw
    path = /var/lib/sphinxsearch/data/index/ch_bakom_versorgungsgebiet-ukw
}

index ch_bafu_hydrologie-wassertemperaturmessstationen : ch_astra_ivs-nat
{
    source = src_ch_bafu_hydrologie-wassertemperaturmessstationen
    path = /var/lib/sphinxsearch/data/index/ch_bafu_hydrologie-wassertemperaturmessstationen
}

index ch_bafu_hydrologie-gewaesserzustandsmessstationen : ch_astra_ivs-nat
{
    source = src_ch_bafu_hydrologie-gewaesserzustandsmessstationen
    path = /var/lib/sphinxsearch/data/index/ch_bafu_hydrologie-gewaesserzustandsmessstationen
}

index ch_bafu_bundesinventare-auen : ch_astra_ivs-nat
{
    source = src_ch_bafu_bundesinventare-auen
    path = /var/lib/sphinxsearch/data/index/ch_bafu_bundesinventare-auen
}

index ch_swisstopo_lubis-luftbilder : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_lubis-luftbilder
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_lubis-luftbilder
}

index ch_swisstopo_lubis-luftbilder-dritte-kantone : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_lubis-luftbilder-dritte-kantone
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_lubis-luftbilder-dritte-kantone
}

index ch_swisstopo_lubis-luftbilder-dritte-firmen : ch_astra_ivs-nat
{
    source = src_ch_swisstopo_lubis-luftbilder-dritte-firmen
    path = /var/lib/sphinxsearch/data/index/ch_swisstopo_lubis-luftbilder-dritte-firmen
}

#
#
# Not needed right now because we only support searchable layers
#index ch_bfs_gebaeude_wohnungs_register
#{
#    type = plain # Which is also the default value
#    source = src_ch_bfs_gebaeude_wohnungs_register
#    path = /var/lib/sphinxsearch/data/index/ch.bfs.gebaeude_wohnungs_register
#    docinfo = extern
#    charset_type = utf-8
#    min_prefix_len = 1
#    prefix_fields = geom_quadindex
#    enable_star = 1
#}


indexer
{
    mem_limit = 512M
    max_iosize = 1048576
}

searchd
{
    port = 9312
    log = /var/run/sphinxsearch/searchd.log
    query_log = /var/run/sphinxsearch/query.log
    pid_file = /var/run/sphinxsearch/searchd.pid
    dist_threads = 4
    read_timeout = 5
    max_children = 90
    max_matches = 10000
}
